
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sistema Documental Insular</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: url('fondo.jpg') no-repeat center center fixed;
      background-size: cover;
    }
    header {
      display: flex;
      align-items: center;
      background: rgba(255,255,255,0.9);
      padding: 10px;
    }
    header img {
      height: 50px;
      margin-right: 10px;
    }
    h2 {
      margin: 0;
      color: #003366;
    }
    main {
      background: rgba(255,255,255,0.95);
      margin: 20px;
      padding: 20px;
      border-radius: 10px;
    }
    input, select, button {
      margin: 5px 0;
      padding: 10px;
      width: 100%;
      max-width: 400px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    th {
      background: #003366;
      color: white;
    }
    .status {
      margin-top: 10px;
      color: green;
    }
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Logo">
    <h2>Sistema Documental Insular</h2>
  </header>
  <main>
    <form id="form">
      <label for="tipo">Tipo de documento:</label>
      <select id="tipo" required>
        <option value="">Selecciona una categorÃ­a</option>
        <option value="ğŸ“„ Plano">ğŸ“„ Plano</option>
        <option value="ğŸ“‘ Memorando">ğŸ“‘ Memorando</option>
        <option value="ğŸ“ Acta">ğŸ“ Acta</option>
        <option value="ğŸ“˜ Normativa">ğŸ“˜ Normativa</option>
        <option value="ğŸ“‚ Otro">ğŸ“‚ Otro</option>
        <option value="ğŸ“Š Excel">ğŸ“Š Excel</option>
      </select>
      <input type="file" id="file" required />
      <button type="submit">Subir documento</button>
      <div class="status" id="status"></div>
    </form>

    <input type="text" id="search" placeholder="Buscar por nombre..." />
    <select id="filterTipo">
      <option value="">Filtrar por tipo</option>
      <option value="ğŸ“„ Plano">ğŸ“„ Plano</option>
      <option value="ğŸ“‘ Memorando">ğŸ“‘ Memorando</option>
      <option value="ğŸ“ Acta">ğŸ“ Acta</option>
      <option value="ğŸ“˜ Normativa">ğŸ“˜ Normativa</option>
      <option value="ğŸ“‚ Otro">ğŸ“‚ Otro</option>
      <option value="ğŸ“Š Excel">ğŸ“Š Excel</option>
    </select>

    <table>
      <thead>
        <tr>
          <th>Tipo</th>
          <th>Nombre</th>
          <th>Fecha</th>
          <th>Descargar</th>
        </tr>
      </thead>
      <tbody id="tabla"></tbody>
    </table>
  </main>

  <script>
    const token = "8085382733:AAEuEHAfeqkiu_teu9TmH8CFF5TiYrKUDyQ";
    const chatId = "-1002773184301";
    const tabla = document.getElementById("tabla");
    const status = document.getElementById("status");
    let datos = JSON.parse(localStorage.getItem("documentos") || "[]");

    function render() {
      const filtro = document.getElementById("filterTipo").value;
      const search = document.getElementById("search").value.toLowerCase();
      tabla.innerHTML = "";
      datos
        .filter(d => (!filtro || d.tipo === filtro))
        .filter(d => d.nombre.toLowerCase().includes(search))
        .forEach(d => {
          tabla.innerHTML += `<tr>
            <td>${d.tipo}</td>
            <td>${d.nombre}</td>
            <td>${d.fecha}</td>
            <td><a href="${d.url}" download="${d.nombre}">ğŸ“¥</a></td>
          </tr>`;
        });
    }

    document.getElementById("form").addEventListener("submit", async e => {
      e.preventDefault();
      const tipo = document.getElementById("tipo").value;
      const fileInput = document.getElementById("file");
      const file = fileInput.files[0];
      if (!file || !tipo) return;

      const fecha = new Date().toLocaleDateString("es-VE");
      const formData = new FormData();
      formData.append("chat_id", chatId);
      formData.append("document", file);
      formData.append("caption", `${tipo}\nğŸ“ ${file.name}\nğŸ—“ï¸ Fecha: ${fecha}`);

      const r = await fetch(`https://api.telegram.org/bot${token}/sendDocument`, {
        method: "POST",
        body: formData
      });

      if (r.ok) {
        const url = URL.createObjectURL(file);
        datos.push({ tipo, nombre: file.name, fecha, url });
        localStorage.setItem("documentos", JSON.stringify(datos));
        render();
        status.textContent = "âœ… Documento enviado correctamente.";
        fileInput.value = "";
      } else {
        status.textContent = "âŒ Error al enviar a Telegram.";
      }
    });

    document.getElementById("search").addEventListener("input", render);
    document.getElementById("filterTipo").addEventListener("change", render);
    render();
  </script>
</body>
</html>
