
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sistema Documental Insular</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0 15px;
      background: url('fondo_institucional.jpg') no-repeat center center fixed;
      background-size: cover;
    }
    header {
      display: flex;
      align-items: center;
      gap: 10px;
      background-color: rgba(255,255,255,0.85);
      padding: 10px;
    }
    header img { height: 50px; }
    h2 { color: #003366; margin: 0; }
    main {
      background-color: rgba(255,255,255,0.95);
      padding: 15px;
      margin-top: 10px;
      border-radius: 10px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      background: white;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #003366;
      color: white;
    }
    select, input[type="file"], input[type="text"], button {
      margin: 10px 5px;
      padding: 8px;
      max-width: 100%;
    }
    .status {
      margin-top: 10px;
      color: green;
      font-weight: bold;
    }
    @media (max-width: 768px) {
      header { flex-direction: column; align-items: flex-start; }
      table, thead, tbody, th, td, tr {
        display: block;
      }
      tr { margin-bottom: 15px; }
      th { background-color: transparent; color: black; font-weight: bold; }
    }
  </style>
</head>
<body>
  <header>
    <img src="logo_gobierno_insular_web.png" alt="Logo" />
    <h2>Sistema Documental Insular</h2>
  </header>
  <main>
    <form id="uploadForm">
      <label for="tipo">Tipo de documento:</label>
      <select id="tipo" required>
        <option value="">Selecciona una categorÃ­a</option>
        <option value="ğŸ“„ Plano">ğŸ“„ Plano</option>
        <option value="ğŸ“‘ Memorando">ğŸ“‘ Memorando</option>
        <option value="ğŸ“ Acta">ğŸ“ Acta</option>
        <option value="ğŸ“˜ Normativa">ğŸ“˜ Normativa</option>
        <option value="ğŸ“‚ Otro">ğŸ“‚ Otro</option>
        <option value="ğŸ“Š Excel">ğŸ“Š Excel</option>
      </select>
      <input type="file" id="fileInput" required />
      <button type="submit">Subir y enviar</button>
      <p id="status" class="status"></p>
    </form>

    <input type="text" id="search" placeholder="Buscar por nombre..." />
    <select id="filterTipo">
      <option value="">Filtrar por tipo</option>
      <option value="ğŸ“„ Plano">ğŸ“„ Plano</option>
      <option value="ğŸ“‘ Memorando">ğŸ“‘ Memorando</option>
      <option value="ğŸ“ Acta">ğŸ“ Acta</option>
      <option value="ğŸ“˜ Normativa">ğŸ“˜ Normativa</option>
      <option value="ğŸ“‚ Otro">ğŸ“‚ Otro</option>
      <option value="ğŸ“Š Excel">ğŸ“Š Excel</option>
    </select>

    <table id="documentTable">
      <thead>
        <tr><th>Tipo</th><th>Nombre</th><th>Fecha</th><th>Descargar</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </main>
  <script>
    const tabla = document.querySelector("#documentTable tbody");
    const status = document.getElementById("status");
    const chatId = "-1002773184301";
    const botToken = "8085382733:AAEuEHAfeqkiu_teu9TmH8CFF5TiYrKUDyQ";

    let historial = JSON.parse(localStorage.getItem("documentos")) || [];

    function renderTabla() {
      tabla.innerHTML = "";
      const search = document.getElementById("search").value.toLowerCase();
      const filterTipo = document.getElementById("filterTipo").value;
      historial
        .filter(doc => (!filterTipo || doc.tipo === filterTipo))
        .filter(doc => doc.nombre.toLowerCase().includes(search))
        .forEach(doc => {
          const fila = `<tr>
            <td>${doc.tipo}</td>
            <td>${doc.nombre}</td>
            <td>${doc.fecha}</td>
            <td><a href="${doc.url}" download="${doc.nombre}">ğŸ“¥</a></td>
          </tr>`;
          tabla.innerHTML += fila;
        });
    }

    document.getElementById("uploadForm").addEventListener("submit", async e => {
      e.preventDefault();
      const tipo = document.getElementById("tipo").value;
      const fileInput = document.getElementById("fileInput");
      const file = fileInput.files[0];
      if (!tipo || !file) return;

      const fecha = new Date().toLocaleDateString("es-VE");
      const fileData = new FormData();
      fileData.append("chat_id", chatId);
      fileData.append("document", file);
      fileData.append("caption", `${tipo}
ğŸ“ ${file.name}
ğŸ—“ï¸ Fecha: ${fecha}`);

      const response = await fetch(`https://api.telegram.org/bot${botToken}/sendDocument`, {
        method: "POST",
        body: fileData,
      });

      if (response.ok) {
        const fakeURL = URL.createObjectURL(file);
        historial.push({ tipo, nombre: file.name, fecha, url: fakeURL });
        localStorage.setItem("documentos", JSON.stringify(historial));
        renderTabla();
        status.textContent = "âœ… Documento enviado a Telegram correctamente.";
      } else {
        status.textContent = "âŒ Error al enviar a Telegram.";
      }
    });

    document.getElementById("search").addEventListener("input", renderTabla);
    document.getElementById("filterTipo").addEventListener("change", renderTabla);
    renderTabla();
  </script>
</body>
</html>
